<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>butterfly: An R package for the verification of continually updating timeseries data where we expect new values, but want to ensure previous data remains unchanged. • butterfly</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="butterfly: An R package for the verification of continually updating timeseries data where we expect new values, but want to ensure previous data remains unchanged.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">butterfly</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/butterfly.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/butterfly_in_pipeline.html">Using butterfly in an operational data pipeline</a></li>
    <li><a class="dropdown-item" href="../articles/butterfly_paper.html">butterfly: An R package for the verification of continually updating timeseries data where we expect new values, but want to ensure previous data remains unchanged.</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ropensci/butterfly/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>butterfly: An R package for the verification of continually updating timeseries data where we expect new values, but want to ensure previous data remains unchanged.</h1>
            
            <h4 data-toc-skip class="date">23 October 2024</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/butterfly/blob/main/vignettes/articles/butterfly_paper.Rmd" class="external-link"><code>vignettes/articles/butterfly_paper.Rmd</code></a></small>
      <div class="d-none name"><code>butterfly_paper.Rmd</code></div>
    </div>

    
    
<p>#&gt; left out bibliography: paper.bib from yaml</p>
<div class="section level2">
<h2 id="active-work-in-progress">
<strong>Active work in progress!</strong><a class="anchor" aria-label="anchor" href="#active-work-in-progress"></a>
</h2>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>Previously recorded data could be revised after initial publication
number of reasons, such as discovery of an inconsistency or error, a
change in methodology or instrument re-calibration. When using other
data to generate your own, it is crucial to reference the exact version
of the data used, in order to maintain data provenance. Unnoticed
changes in previous data could have unintended consequences, such as
invalidating a published dataset’s Digital Object Identfier (DOI), or
altering future predictions if used as input in forecasting models.</p>
<p>But what if you are not aware of upstream changes to your input data?
Monitoring data sources for these changes is not always possible. Here
we present butterfly, an R package for the verification of continually
updating timeseries data where we expect new values, but want to ensure
previous data remains unchanged.</p>
<p>The intention of butterfly is to check for changes in previously
published data, and warn the user with a report that contains as much
details as possible. This will allow them to stop unintended data
transfer, revise their published data, release a new version and
communicate the significance of the change to their users.</p>
</div>
<div class="section level2">
<h2 id="statement-of-need">Statement of Need<a class="anchor" aria-label="anchor" href="#statement-of-need"></a>
</h2>
<p>Semantic versioning is widely adopted in research software <a href="https://semver.org/spec/v2.0.0.html" class="external-link">(Preston-Werner 2013)</a>,
but as outlined above datasets may also change for any number of
reasons. It is therefore important to cite the exact extract of data you
are using in your research to maintain reproducibility <a href="https://datascience.codata.org/articles/10.5334/dsj-2021-012" class="external-link">(Klump
et al. 2021)</a>. It is not only important to indicate to users that
there has been a change, but also <strong>what</strong> that change
is.</p>
<p>This may be especially relevant for Information Management Frameworks
for Digital Twins (Siddorn et al. 2022). A digital twin might rely on
any number of source data, whether live sensor streams or environmental
forecasting models. To achieve a FAIR implementation (Wilkinson et
al. 2016) of a Digital Twin, data provenance must be maintained, clearly
documented for users and available in machine-readable format.</p>
<p>To ensure trustworthiness, apply appropriate versioning and maintain
the integrity of our published dataset DOI’s we require tools to monitor
and quality control changes in them. This is what butterfly aims to
provide. The underlying functionality is largely based on the waldo
package, and it also follows waldo’s philosophy of being as verbose as
possible (Wickham).</p>
<p>Below we describe two case studies where we applied butterfly in work
done at the British Antarctic Survey.</p>
<div class="section level3">
<h3 id="case-study-1-unexpected-changes-in-models">Case Study 1: unexpected changes in models<a class="anchor" aria-label="anchor" href="#case-study-1-unexpected-changes-in-models"></a>
</h3>
<p>The Amundsen Seas Low (ASL) is a highly dynamic and mobile
climatological low pressure system located in the Pacific sector of the
Southern Ocean. In this sector, variability in sea-level pressure is
greater than anywhere in the Southern Hemisphere, making it challenging
to isolate local fluctuations in the ASL from larger-scale shifts in
atmospheric pressure. The position and strength of the ASL are crucial
for understanding regional change over West Antarctica (Hosking et
al. 2016). To calculate the ASL indices and generate our dataset, we use
ERA5 data (Hersbach et al. 2023).</p>
<p>This package was originally developed to deal with <a href="https://cds.climate.copernicus.eu/datasets/reanalysis-era5-single-levels?tab=documentation" class="external-link">ERA5</a>’s
initial release data, ERA5T. ERA5T data for a month is overwritten with
the final ERA5 data two months after the month in question. Usually ERA5
and ERA5T are identical, but occasionally an issue with input data can
(for example for <a href="https://confluence.ecmwf.int/display/CKB/ERA5T+issue+in+snow+depth" class="external-link">09/21
- 12/21</a>, and <a href="https://forum.ecmwf.int/t/final-validated-era5-product-to-differ-from-era5t-in-july-2024/6685" class="external-link">07/24</a>)
force a recalculation, meaning previously published data differs from
the final product.</p>
<p>In most cases, this is not an issue. For static data publications
which are a snapshot in time, such as research that uses ERA5 data and
is associated with a specific paper, as in “Forecasts, neural networks,
and results from the paper: ‘Seasonal Arctic sea ice forecasting with
probabilistic deep learning’” <a href="https://data.bas.ac.uk/full-record.php?id=GB/NERC/BAS/PDC/01526" class="external-link">Andersson
&amp; Hosking (2021)</a> or time period as in “Downscaled ERA5 monthly
precipitation data using Multi-Fidelity Gaussian Processes between 1980
and 2012 for the Upper Beas and Sutlej Basins, Himalaya” <a href="https://data.bas.ac.uk/full-record.php?id=GB/NERC/BAS/PDC/01769" class="external-link">Tazi
(2023)</a>, this is not an issue. These datasets clearly describe a
version and time period of ERA5 from which the data were derived, and
will not be amended or updated in the future, even if ERA5 is
recalculated.</p>
<p>In our case however we want to continually append ERA5-derived ASL
calculations <strong>and</strong> continually publish them. This would
be useful when functioning as a data source for an environmental digital
twin (Blair &amp; Henrys et al. 2023), or simply as input data into an
environmental forecasting model which itself is frequently running.</p>
<p>Continually appending <strong>and</strong> publishing will require
strict quality assurance. Any change in any change in previous ERA5
data, will also change the results of all our previous ASL calculations.
If this happened and we overwrite our dataset, we would be changing
values in an already-published dataset. Or, if we append our existing
dataset, anyone attempting to reproduce our methods would get different
results, because previous calculations are not based on the same version
of ERA5. Either way, our DOI will be invalidated.</p>
<p>In butterfly, <code><a href="../reference/loupe.html">loupe()</a></code> is provided to examine in detail
whether previous values have changed, and returns TRUE/FALSE for no
change/change. To manipulate changed data, <code><a href="../reference/catch.html">catch()</a></code>
“catches” the changes and returns them in a dataframe, while
<code><a href="../reference/release.html">release()</a></code> “releases” the changes and returns a dataframe
without the detected changes.</p>
<p>We use the functionality in this package in an automated data
processing pipeline to detect changes, stop data transfer and notify the
user. The full methods are described in this <a href="https://thomaszwagerman.github.io/butterfly/articles/butterfly_in_pipeline.html">article</a>
and source code is available in <a href="https://github.com/antarctica/asli-pipeline" class="external-link">this repository</a>
(Zwagerman &amp; Wilby)</p>
</div>
<div class="section level3">
<h3 id="case-study-2-unexpected-changes-in-data-acquisition">Case Study 2: unexpected changes in data acquisition<a class="anchor" aria-label="anchor" href="#case-study-2-unexpected-changes-in-data-acquisition"></a>
</h3>
<p>Measuring instruments can have different behaviours when they have a
power failure. For example, during power failure an internal clock could
reset to “1970-01-01”, or the manufacturing date (e.g. a Raspberry Pi
manufactured in 2021 will return to “2021-01-01”, one manufactured in
2022 to “2022-01-01” etc). If we are automatically ingesting and
processing this data, it would be great to get a head’s up that a time
series is no longer continuous in the way we expect it to be. We could
also mistake new data as “previous” data. This could have consequences
for any calculation happening downstream.</p>
<p>To prevent writing different ways of checking for this depending on
the instrument, we wrote <code><a href="../reference/timeline.html">butterfly::timeline()</a></code>. It will
return TRUE/FALSE depending on whether a time series is deemed
continuous, based on an expected time step between each measurement.</p>
<div class="section level4">
<h4 id="variable-measurement-frequencies">Variable measurement frequencies<a class="anchor" aria-label="anchor" href="#variable-measurement-frequencies"></a>
</h4>
<p>In other cases, a non-continuous timeseries is intentional, for
example when there is temporal variability in the measurements taken
depending on events. At BAS, we collect data from a penguin weighbridge
on weighbridge on Bird Island, South Georgia. This weighbridge measure
weight on two different load cells (scales) to determine penguin weight
and direction.</p>
<p>You can read about this work in more detail in <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0126292" class="external-link">Afanasyev
et al. (2015)</a>, but the important point here is that the weighbridge
does not collect continuous measurement. When no weight is detected on
the load cells, it only samples at 1hz, but as soon as any change in
weight is detected it will start collecting data at 100hz. This is of
course intentional, to reduce the sheer volume of data we need to
process, but also has another benefit in isolating (or attempting to)
individual crossings.</p>
<p>The individual crossings are the most valuables pieces of data, as
these allow us to deduce some sort of information like weight, direction
(from colony to sea, or sea to colony) and hopefully ultimately,
diet.</p>
<p>In this case separating distinct, but continuous segments of data is
required. This is the reasoning behind <code><a href="../reference/timeline_group.html">timeline_group()</a></code>.
This function allows us to split our timeseries in groups of individual
crossings.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="acknowledgements">Acknowledgements<a class="anchor" aria-label="anchor" href="#acknowledgements"></a>
</h2>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Expect formatting changes below.</p>
<p>Afanasyev V, Buldyrev SV, Dunn MJ, Robst J, Preston M, et al. 2015.
Increasing Accuracy: A New Design and Algorithm for Automatically
Measuring Weights, Travel Direction and Radio Frequency Identification
(RFID) of Penguins. PLOS ONE 10(4): e0126292. <a href="https://doi.org/10.1371/journal.pone.0126292" class="external-link uri">https://doi.org/10.1371/journal.pone.0126292</a></p>
<p>Andersson, T., &amp; Hosking, J. 2021. Forecasts, neural networks,
and results from the paper: ‘Seasonal Arctic sea ice forecasting with
probabilistic deep learning’ (Version 1.0) [Data set]. NERC EDS UK Polar
Data Centre. <a href="https://doi.org/10.5285/71820e7d-c628-4e32-969f-464b7efb187c" class="external-link uri">https://doi.org/10.5285/71820e7d-c628-4e32-969f-464b7efb187c</a></p>
<p>Blair, Gordon S., and Peter A. Henrys. 2023. “The Role of Data
Science in Environmental Digital Twins: In Praise of the Arrows.”
Environmetrics 34 (January): Not available. <a href="https://doi.org/10.1002/env.2789" class="external-link uri">https://doi.org/10.1002/env.2789</a>.</p>
<p>Hersbach, H., Bell, B., Berrisford, P., Biavati, G., Horányi, A.,
Muñoz Sabater, J., Nicolas, J., Peubey, C., Radu, R., Rozum, I.,
Schepers, D., Simmons, A., Soci, C., Dee, D., Thépaut, J-N. (2023): ERA5
hourly data on single levels from 1940 to present. Copernicus Climate
Change Service (C3S) Climate Data Store (CDS), DOI:
10.24381/cds.adbb2d47</p>
<p>Hosking, J. S., A. Orr, T. J. Bracegirdle, and J. Turner. 2016.
Future circulation changes off West Antarctica: Sensitivity of the
Amundsen Sea Low to projected anthropogenic forcing, Geophys. Res.
Lett., 43, 367–376, <a href="doi:10.1002/2015GL067143" class="uri">doi:10.1002/2015GL067143</a>.</p>
<p>Klump, J., Wyborn, L., Wu, M., Martin, J., Downs, R.R. and Asmi, A.
2021. ‘Versioning Data Is About More than Revisions: A Conceptual
Framework and Proposed Principles’, Data Science Journal, 20(1), p. 12.
Available at: <a href="https://doi.org/10.5334/dsj-2021-012" class="external-link uri">https://doi.org/10.5334/dsj-2021-012</a>.</p>
<p>Preston-Werner, T. 2013. Semantic Versioning 2.0.0. Semantic
Versioning. Available at <a href="https://semver.org/spec/v2.0.0.html" class="external-link uri">https://semver.org/spec/v2.0.0.html</a> [Last accessed 28
October 2024].</p>
<p>Siddorn, John, Gordon Shaw Blair, David Boot, Justin James Henry
Buck, Andrew Kingdon, et al. 2022. “An Information Management Framework
for Environmental Digital Twins (IMFe).” Zenodo. <a href="https://doi.org/10.5281/ZENODO.7004351" class="external-link uri">https://doi.org/10.5281/ZENODO.7004351</a>.</p>
<p>Tazi, K. 2023. Downscaled ERA5 monthly precipitation data using
Multi-Fidelity Gaussian Processes between 1980 and 2012 for the Upper
Beas and Sutlej Basins, Himalayas (Version 1.0) [Data set]. NERC EDS UK
Polar Data Centre. <a href="https://doi.org/10.5285/b2099787-b57c-44ae-bf42-0d46d9ec87cc" class="external-link uri">https://doi.org/10.5285/b2099787-b57c-44ae-bf42-0d46d9ec87cc</a></p>
<p>Wickham, H. waldo: Find Differences Between R Objects [Computer
software]. <a href="https://github.com/r-lib/waldo" class="external-link uri">https://github.com/r-lib/waldo</a></p>
<p>Wilkinson, Mark D., Michel Dumontier, IJsbrand Jan Aalbersberg,
Gabrielle Appleton, Myles Axton, et al. 2016. “The FAIR Guiding
Principles for Scientific Data Management and Stewardship.” Scientific
Data 3 (1). <a href="https://doi.org/10.1038/sdata.2016.18" class="external-link uri">https://doi.org/10.1038/sdata.2016.18</a>.</p>
<p>Zwagerman, T., &amp; Wilby, D. (2024). asli-pipeline (0.1.0). Zenodo.
<a href="https://doi.org/10.5281/zenodo.14552486" class="external-link uri">https://doi.org/10.5281/zenodo.14552486</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Zwagerman.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
